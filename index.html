<!doctype html>
<html lang="en">
<head>
  <!-- Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Waukesha County Housing Market Statistics</title>
  <meta name="description" content="Latest Waukesha County housing market statistics with side-by-side Single-Family and Condo snapshots, plus quick links to community pages." />

  <!-- SEO / Social -->
  <link rel="canonical" href="https://waukesha-market-stats.vercel.app/" />
  <meta name="robots" content="index,follow" />
  <meta property="og:site_name" content="Josh Werner — Realty ONE Group Luminous" />

  <meta property="og:title" content="Waukesha County Housing Market Statistics" />
  <meta property="og:description" content="Latest Waukesha County market stats — Median Price, Closed Sales, DOM, and Months Supply — updated automatically from RPR." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://waukesha-market-stats.vercel.app/" />
  <meta property="og:image" content="https://waukesha-market-stats.vercel.app/og-image.png" />
  <meta property="og:image:alt" content="Waukesha County Market Statistics" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Waukesha County Housing Market Statistics" />
  <meta name="twitter:description" content="Latest Waukesha County market stats — updated from RPR." />
  <meta name="twitter:image" content="https://waukesha-market-stats.vercel.app/og-image.png" />

  <meta name="theme-color" content="#C5A349" />

  <!-- Screen styles (no print styles here) -->
  <style>
    :root {
      --brand:#C5A349; --ink:#1f2937; --muted:#6b7280; --bg:#f7f7f9; --card:#fff;
      --radius:16px; --shadow:0 10px 24px rgba(0,0,0,.08); --shadow-sm:0 3px 10px rgba(0,0,0,.06);
      --maxw:1100px;
    }

    html, body { height:100%; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; color:var(--ink); background:var(--bg); }

    .container { max-width:var(--maxw); margin-inline:auto; padding:24px; }
    .hero { background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px 18px; }
    .title { margin:0; font-size:clamp(22px,3vw,34px); font-weight:800; }
    .subtitle { margin:4px 0 0 0; color:var(--muted); font-size:14px; }
    .controls { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .pill { display:flex; gap:10px; padding:8px 12px; border-radius:999px; background:#fff; border:1px solid #e5e7eb; box-shadow:var(--shadow-sm); }
    .select, .button { border:1px solid #e5e7eb; background:#fff; border-radius:12px; padding:10px 12px; font-size:14px; }
    .button { cursor:pointer; }

    /* Sticky subnav (screen only) */
    .subnav {
      position:-webkit-sticky; /* Safari */
      position:sticky;
      top:0;
      z-index:1000;

      display:flex;
      gap:14px;
      margin-top:8px;
      font-size:14px;

      background:var(--card);
      padding:10px 0;
      border-top:1px solid #eee;
      border-bottom:1px solid #eee;
      box-shadow:0 2px 10px rgba(0,0,0,.04);
    }
    .subnav a { color:var(--muted); }
    .subnav a:hover { color:var(--ink); }

    .grid-2 { display:grid; grid-template-columns:1fr; gap:16px; margin-top:16px; }
    @media (min-width:900px) { .grid-2 { grid-template-columns:1fr 1fr; } }

    .card { background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px 18px; }

    .kpis { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:8px; }
    @media (min-width:720px) { .kpis { grid-template-columns:repeat(3,1fr); } }

    .kpi { border:1px solid #eef0f3; border-radius:14px; padding:12px; background:#fff; }
    .kpi .label { font-size:12px; color:var(--muted); text-transform:uppercase; }
    .kpi .value { font-size:clamp(22px,3vw,28px); font-weight:800; margin-top:6px; }
    .kpi .delta { font-size:12px; margin-top:4px; }
    .up { color:#15803d; } .down { color:#b91c1c; }

    .community-card { display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border:1px solid #eef0f3; border-radius:12px; background:#fff; box-shadow:var(--shadow-sm); }
    .community-grid { display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width:680px) { .community-grid { grid-template-columns:repeat(2,1fr); } }
    @media (min-width:980px) { .community-grid { grid-template-columns:repeat(3,1fr); } }

    .search { display:flex; gap:10px; align-items:center; padding:10px 12px; border-radius:12px; background:#fff; border:1px solid #e5e7eb; box-shadow:var(--shadow-sm); }
    .search input { border:none; outline:none; flex:1; font-size:14px; }

    a.link { color:var(--ink); text-decoration:none; border-bottom:1px solid #ddd; }

    .foot { display:flex; align-items:center; justify-content:space-between; gap:12px; color:var(--muted); font-size:12px; margin-top:14px; }

    /* Smooth anchor scroll + offset for sticky nav */
    html { scroll-behavior:smooth; }
    #sf, #condo, #communities { scroll-margin-top:80px; }
  /* --- Loading skeletons --- */
.skel { background: #eef0f3; border-radius: 10px; height: 32px; animation: pulse 1.2s ease-in-out infinite; }
@keyframes pulse { 0%{opacity:.6} 50%{opacity:1} 100%{opacity:.6} }
.muted { color: var(--muted); }

/* --- Embed mode (hide chrome in iframes) --- */
.embed header.container,
.embed footer.container { display: none; }
.embed .container { padding-top: 12px; }
  /* --- Brand accents: soft gold tints and cleaner controls --- */
:root{
  --brand-50:#f8f3e6;
  --brand-100:#f1e6c9;
  --brand-200:#e7d5a1;
  --brand-600:#a8842d;
  --brand-700:#8f6f25;
}

/* Primary button */
.button{
  background: var(--brand);
  color: #fff;
  border-color: var(--brand-600);
  box-shadow: var(--shadow-sm);
}
.button:hover{ filter: brightness(0.95); }

/* Small chips */
.pill{
  background: var(--brand-50);
  border-color: var(--brand-200);
}

/* Month tag style (you already have <span class="badge" ...>) */
.badge{
  background: var(--brand-50);
  border: 1px solid var(--brand-200);
  color: var(--brand-700);
  padding: 4px 8px;
  border-radius: 999px;
  font-size: 12px;
}

/* Links: lighter underline, stronger on hover */
a.link{ border-bottom-color: rgba(197,163,73,.4); }
a.link:hover{ border-bottom-color: var(--brand); }
  /* --- Hero background: soft brand mist --- */
.hero{
  background:
    radial-gradient(600px 220px at 85% -10%, rgba(197,163,73,.18), transparent 70%),
    radial-gradient(520px 180px at -10% 110%, rgba(197,163,73,.12), transparent 70%),
    var(--card);
}
    /* --- Card accent + gentle hover (screen only) --- */
.card{
  position: relative;
  transition: box-shadow .2s ease, transform .2s ease;
}
@media (hover:hover){
  .card:hover{
    box-shadow: 0 12px 26px rgba(0,0,0,.10);
    transform: translateY(-1px);
  }
}
.card::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:3px;
  border-radius: var(--radius) var(--radius) 0 0; /* round the top corners */
  background: linear-gradient(90deg, var(--brand), rgba(197,163,73,0) 65%);
  pointer-events:none;
}
    /* --- Warm page background --- */
:root { --bg: #fbfaf7; }  /* was #f7f7f9; this is a touch warmer */
body  { background: var(--bg); }
  /* --- Community row dividers (mobile only) --- */
@media (max-width: 679.98px){
  .community-grid{ row-gap: 8px; }
  .community-card{
    position: relative;
    border-color: #e9e5d6; /* warmer, softer */
  }
  .community-card::after{
    content:"";
    position:absolute;
    left:12px; right:12px; bottom:-7px;
    height:1px;
    background: linear-gradient(90deg, transparent, rgba(197,163,73,.25), transparent);
    pointer-events:none;
  }
}
  </style>
<style>
/* ---------- Print styles ---------- */
@page { size: Letter portrait; margin: 0.5in; }

@media print {
  html, body { background: #fff !important; color: #111 !important; }
  body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

  /* Layout: two columns for SF/Condo, communities start on page 2 */
  .container { max-width: none !important; padding: 0 !important; }
  header.container, main.container, footer.container { padding: 0 !important; }
  .hero { margin: 0 0 0.25in 0 !important; box-shadow: none !important; border: none !important; border-radius: 0 !important; }
  .subnav, .search, #printBtn { display: none !important; } /* hide nav/search/print button */
  .grid-2 { grid-template-columns: 1fr 1fr !important; gap: 0.35in !important; }
  .card { box-shadow: none !important; border: 1px solid #e5e7eb !important; border-radius: 8px !important; }
  .kpi { break-inside: avoid; }
  #communities.card { page-break-before: always; } /* communities on page 2 */
  .foot { color: #6b7280 !important; }

  /* Tighter type for print */
  .title { font-size: 22px !important; }
  .subtitle { font-size: 12px !important; }
  .kpi .label { font-size: 11px !important; }
  .kpi .value { font-size: 20px !important; }

  /* Make links look nice on paper */
  a.link { color: #111 !important; border-bottom: 1px solid #ddd !important; text-decoration: none !important; }
  /* If you want URLs to print after links, uncomment:
  a.link:after { content: " (" attr(href) ")"; font-size: 11px; color: #6b7280; }
  */

  /* Remove excess margins so content fits one page comfortably */
  .container > * { margin-left: 0.25in; margin-right: 0.25in; }
  .hero, .grid-2, #communities, footer.container { margin-left: 0.25in; margin-right: 0.25in; }
}
  /* --- Community link hover: gentle lift + gold arrow --- */
.community-card{
  transition: box-shadow .15s ease, transform .15s ease, border-color .15s ease, background .15s ease;
}
.community-card span:last-child{
  color:#9ca3af !important;              /* override the inline color from HTML */
  transition: transform .15s ease, color .15s ease;
}
@media (hover:hover){
  .community-card:hover{
    background:#fff;
    border-color:#e6e0cf;
    box-shadow: 0 8px 18px rgba(0,0,0,.08);
    transform: translateY(-1px);
  }
  .community-card:hover span:last-child{
    color: var(--brand-700) !important;   /* warm gold on hover */
    transform: translateX(2px);           /* tiny nudge → */
  }
}
/* Keyboard focus */
.community-card:focus-visible{
  outline: 2px solid var(--brand-200);
  outline-offset: 2px;
}
</style>
<style>
/* Hide the brand block on screen */
.print-brand { display: none; }

/* Print styles for the brand header */
@media print {
  .print-brand {
    display: flex !important;
    align-items: center;
    gap: 14px;
    margin: 0 0 0.25in 0;
    padding-bottom: 10px;
    border-bottom: 1px solid #e5e7eb;
  }
  .print-logo {
    height: 56px;            /* adjust 48–72px to fit your logo */
    max-width: 260px;
    object-fit: contain;
  }
  .print-contact { font-size: 12px; line-height: 1.35; }
  .print-contact strong { font-size: 14px; }
  .print-contact a {
    color: #111 !important;
    text-decoration: none;
    border-bottom: 1px solid #ddd;
  }
  .print-updated { margin-top: 2px; font-size: 11px; color: #6b7280; }
}
</style>
<!-- SEO / Social -->
<link rel="canonical" href="https://waukesha-market-stats.vercel.app/" />
<meta name="robots" content="index,follow" />
<meta property="og:site_name" content="Josh Werner — Realty ONE Group Luminous" />

<meta property="og:title" content="Waukesha County Housing Market Statistics" />
<meta property="og:description" content="Latest Waukesha County market stats — Median Price, Closed Sales, DOM, and Months Supply — updated automatically from RPR." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://waukesha-market-stats.vercel.app/" />
<meta property="og:image" content="https://waukesha-market-stats.vercel.app/og-image.png" />
<meta property="og:image:alt" content="Waukesha County Market Statistics" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Waukesha County Housing Market Statistics" />
<meta name="twitter:description" content="Latest Waukesha County market stats — updated from RPR." />
<meta name="twitter:image" content="https://waukesha-market-stats.vercel.app/og-image.png" />

<meta name="theme-color" content="#C5A349" />
<script id="ld-dataset" type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Dataset",
  "name":"Waukesha County Housing Market Statistics",
  "description":"Monthly market stats for Waukesha County, WI (Single-Family & Condo): Median Price, Closed Sales, Days on Market, and Months Supply. Auto-updated from RPR.",
  "creator":{"@type":"Person","name":"Josh Werner"},
  "publisher":{"@type":"Organization","name":"Realty ONE Group Luminous"},
  "isAccessibleForFree": true,
  "keywords":["Waukesha County","real estate","market statistics","Wisconsin"],
  "license":"https://www.narrpr.com/terms/",
  "distribution":[
    {"@type":"DataDownload","encodingFormat":"application/pdf","contentUrl":"https://www.narrpr.com/reports-v2/c296fac6-035d-4e9a-84fd-28455ab0339f/pdf"},
    {"@type":"DataDownload","encodingFormat":"application/pdf","contentUrl":"https://www.narrpr.com/reports-v2/5a675486-5c7b-4bb0-9946-0cffa3070f05/pdf"}
  ],
  "dateModified":"2025-09-16"
}
</script>
</head>
<body>
  <header class="container">
    <!-- Print-only brand header -->
    <div class="print-brand" aria-hidden="true">
      <img class="print-logo" src="/logo.png" alt="Realty ONE Group Luminous — Josh Werner" />
      <div class="print-contact">
        <strong>Josh Werner</strong><br />
        Licensed REALTOR® — Realty ONE Group Luminous<br />
        <a href="tel:+14147597925">(414) 759-7925</a> ·
        <a href="mailto:joshwernerrealtor@gmail.com">joshwernerrealtor@gmail.com</a> ·
        <a href="https://joshwerner.homes" target="_blank" rel="noopener">joshwerner.homes</a><br />
        WI License #: 93792-94
        <div class="print-updated" id="printUpdated"></div>
      </div>
    </div>

    <!-- your hero content -->
<section class="hero">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <div>
          <h1 class="title">Waukesha County Housing Market Statistics</h1>
          <p class="subtitle">Side by side snapshots for Single-Family and Condos. Updated automatically from RPR.</p>
        </div>
        <div class="controls">
          <span class="pill"><span>Updated</span><strong id="updatedAt">—</strong></span>
          <label class="pill"><span>Month</span><select id="monthSelect" class="select"></select></label>
          <button id="printBtn" class="button" type="button">Print / PDF</button>
        </div>
      </div>
      <nav class="subnav" aria-label="Section navigation">
        <a href="#sf">Single-Family</a>
        <a href="#condo">Condos</a>
        <a href="#communities">Communities</a>
      </nav>
    </section>
  </header>

  <main class="container">
    <section class="grid-2">
      <article id="sf" class="card" aria-labelledby="sfTitle">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
          <h2 id="sfTitle" style="margin:0;font-size:20px">Single-Family Homes</h2>
          <span class="badge" id="sfMonth">—</span>
        </div>
        <div class="kpis" id="sfKpis"></div>
        <div class="foot">
          <span id="sfNote"></span>
          <a id="sfReport" class="link" href="https://www.narrpr.com/reports-v2/c296fac6-035d-4e9a-84fd-28455ab0339f/pdf" target="_blank" rel="noopener">Full county report</a>
        </div>
      </article>

      <article id="condo" class="card" aria-labelledby="condoTitle">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
          <h2 id="condoTitle" style="margin:0;font-size:20px">Condos / Townhomes</h2>
          <span class="badge" id="condoMonth">—</span>
        </div>
        <div class="kpis" id="condoKpis"></div>
        <div class="foot">
          <span id="condoNote"></span>
          <a id="condoReport" class="link" href="https://www.narrpr.com/reports-v2/c296fac6-035d-4e9a-84fd-28455ab0339f/pdf" target="_blank" rel="noopener">Full county report</a>
        </div>
      </article>
    </section>

    <section id="communities" class="card" style="margin-top:16px">
      <div style="display:flex;align-items:end;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <div>
          <h3 style="margin:0;font-size:18px">Top 10 Communities</h3>
          <p class="subtitle" style="margin:6px 0 0 0">These RPR® reports update automatically every ~48 hours. Click a community to view the live PDF.</p>
        </div>
        <div class="search" role="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="7" stroke="#9ca3af" stroke-width="2"/><path d="M20 20l-3.2-3.2" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"/></svg>
          <input id="searchInput" type="search" placeholder="Search communities…" aria-label="Search communities" />
        </div>
      </div>
      <div id="communityGrid" class="community-grid" style="margin-top:12px"></div>
    </section>
  </main>

  <footer class="container" style="opacity:.9;padding-top:0">
    <p style="font-size:12px;color:var(--muted)">Source: Realtors Property Resource® (RPR). County stats auto-refresh from the county PDF via a secure API.</p>
  </footer>

<script>
(() => {
  const ENDPOINT = "/api/waukesha";

  // Communities
  const COMMUNITIES = [
    { name: "Brookfield",        url: "https://www.narrpr.com/reports-v2/97a381b7-10f7-40e6-9e36-852d9a194cdf/pdf" },
    { name: "Menomonee Falls",   url: "https://www.narrpr.com/reports-v2/e88b179b-2c39-4b51-9968-f4d8b6df89cb/pdf" },
    { name: "New Berlin",        url: "https://www.narrpr.com/reports-v2/0eedbe20-e01d-4e10-8791-79e0e18f6853/pdf" },
    { name: "Muskego",           url: "https://www.narrpr.com/reports-v2/adda4cc2-f31f-4549-a499-793c061484b8/pdf" },
    { name: "Pewaukee",          url: "https://www.narrpr.com/reports-v2/d62c13ba-f21d-44d4-b4f1-cb89d62cfd1d/pdf" },
    { name: "Oconomowoc",        url: "https://www.narrpr.com/reports-v2/2635ef10-f399-4498-987f-34784fca249a/pdf" },
    { name: "Hartland",          url: "https://www.narrpr.com/reports-v2/579c97c4-b4d9-4eb4-980e-890348286b9b/pdf" },
    { name: "Delafield",         url: "https://www.narrpr.com/reports-v2/cfaf9afb-4e22-44b9-b114-0d64b1be0639/pdf" },
    { name: "Mukwonago",         url: "https://www.narrpr.com/reports-v2/17d2ea0c-a2d7-4dce-954c-e2140ac59f88/pdf" },
    { name: "Sussex",            url: "https://www.narrpr.com/reports-v2/41f387a4-b092-42c4-b23a-b3575ae52116/pdf" }
  ];

  // Params / iframe detection
  const params = new URLSearchParams(location.search);
  const isEmbedded = (window.top !== window.self);
  const shouldAutoPrint = params.get('print') === '1';

  // Shortcuts
  const $=(q,el=document)=>el.querySelector(q);

  // Elements
  const updatedAtEl=$("#updatedAt"), monthSelect=$("#monthSelect");
  const sfMonthEl=$("#sfMonth"), condoMonthEl=$("#condoMonth");
  const sfKpis=$("#sfKpis"), condoKpis=$("#condoKpis");
  const sfReport=$("#sfReport"), condoReport=$("#condoReport");
  const searchInput=$("#searchInput"), communityGrid=$("#communityGrid");

  // Formatters
  const fCurrency=v=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(v);
  const fNumber=v=>new Intl.NumberFormat("en-US").format(v);
  const fNumber1=v=>new Intl.NumberFormat("en-US",{maximumFractionDigits:1}).format(v);

  // KPI (hide MoM if no previous month)
  function kpiEl(label, value, prev, type){
    const el = document.createElement("div");
    el.className = "kpi";

    const hasValue = typeof value === "number" && !Number.isNaN(value);
    const hasPrev  = typeof prev  === "number" && !Number.isNaN(prev);

    let formatted = "—";
    if (hasValue) {
      formatted = type === "currency" ? fCurrency(value)
                : type === "number1" ? fNumber1(value)
                : fNumber(value);
    }

    let deltaBlock = "";
    if (hasValue && hasPrev) {
      const diff = value - prev;
      const dir  = diff === 0 ? 0 : (diff > 0 ? 1 : -1);
      const pct  = prev === 0 ? 0 : (diff / prev) * 100;
      const arrow = dir === 0 ? "—" : (dir > 0 ? "▲" : "▼");
      const cls   = dir === 0 ? "" : (dir > 0 ? "up" : "down");
      deltaBlock = `<div class="delta ${cls}">${arrow} ${Math.abs(pct).toFixed(1)}% MoM</div>`;
    }

    el.innerHTML = `
      <div class="label">${label}</div>
      <div class="value">${formatted}</div>
      ${deltaBlock}
    `;
    return el;
  }

  function paintMonth(key, dataObj){
    const months=Object.keys(dataObj.months).sort();
    const idx=months.indexOf(key); const cur=dataObj.months[key]; const prev=dataObj.months[months[idx-1]];
    const [y,m]=key.split("-"); const label=new Date(+y, +m-1, 1).toLocaleDateString(undefined,{month:"long",year:"numeric"});
    if (sfMonthEl) sfMonthEl.textContent=label;
    if (condoMonthEl) condoMonthEl.textContent=label;
    if (sfKpis) sfKpis.innerHTML="";
    if (condoKpis) condoKpis.innerHTML="";

    const METRICS = [
      { key:"medianPrice",   label:"Median Price",   type:"currency" },
      { key:"closed",        label:"Closed Sales",   type:"number"   },
      { key:"dom",           label:"Days on Market", type:"number"   },
      { key:"monthsSupply",  label:"Months Supply",  type:"number1"  },
      { key:"activeListings",label:"Active Listings",type:"number"   }
    ];

    METRICS.forEach(m=>{
      if (sfKpis) sfKpis.appendChild(kpiEl(m.label, cur.sf?.[m.key],    prev?.sf?.[m.key],    m.type));
      if (condoKpis) condoKpis.appendChild(kpiEl(m.label, cur.condo?.[m.key], prev?.condo?.[m.key], m.type));
    });
  }

  function renderCommunities(list){
    if (!communityGrid) return;
    communityGrid.innerHTML="";
    list.forEach(c=>{
      const a=document.createElement("a");
      a.className="community-card";
      a.href=c.url; a.target="_blank"; a.rel="noopener";
      a.innerHTML=`<span>${c.name}</span><span style="color:#9ca3af">PDF →</span>`;
      communityGrid.appendChild(a);
    });
  }

  function render(payload){
    if (updatedAtEl && payload.updatedAt) {
      updatedAtEl.textContent = new Date(payload.updatedAt).toLocaleDateString();
    }

    const months=Object.keys(payload.months).sort().reverse();
    if (monthSelect) {
      monthSelect.innerHTML="";
      months.forEach(k=>{
        const [y,m]=k.split("-"); const dt=new Date(+y,+m-1,1);
        const opt=document.createElement("option");
        opt.value=k;
        opt.textContent=dt.toLocaleDateString(undefined,{month:"long",year:"numeric"});
        monthSelect.appendChild(opt);
      });
      monthSelect.value=months[0];
      monthSelect.onchange=e=>paintMonth(e.target.value, payload);
    }

    paintMonth(months[0], payload);

    if (sfReport && payload.months[months[0]]?.sfReport) sfReport.href = payload.months[months[0]].sfReport;
    if (condoReport && payload.months[months[0]]?.condoReport) condoReport.href = payload.months[months[0]].condoReport;

    renderCommunities(COMMUNITIES);

    // Print header date
    const pu = $("#printUpdated");
    if (pu && payload?.updatedAt) pu.textContent = "Updated " + new Date(payload.updatedAt).toLocaleDateString();

    // Print button: iframe-safe
    const btn = $("#printBtn");
    if (btn) {
      btn.onclick = () => {
        if (isEmbedded) {
          const url = new URL(location.href);
          url.searchParams.set('print','1'); // auto-print
          url.searchParams.delete('embed');  // ensure print header shows
          window.open(url.toString(), '_blank', 'noopener');
        } else {
          window.print();
        }
      };
    }

    // Auto-print if opened with ?print=1
    if (shouldAutoPrint) {
      setTimeout(() => window.print(), 300);
    }
  }

  async function boot(){
    try{
      // Optional embed mode chrome hide
      if (params.get('embed') === '1') document.body.classList.add('embed');

      const r=await fetch(ENDPOINT, { cache: "no-store" });
      if(!r.ok) throw new Error(`API ${r.status} ${r.statusText}`);
      const json=await r.json();
      render(json);
    }catch(e){
      console.error(e);
      const err = `<div class="kpi"><div class="label">Status</div><div class="value" style="font-size:16px">Couldn’t load live stats</div><div class="delta" style="color:#b91c1c">${(e && e.message) ? e.message : String(e)}</div></div>`;
      if (sfKpis) sfKpis.innerHTML = err;
      if (condoKpis) condoKpis.innerHTML = err;
    }
  }

  document.addEventListener("DOMContentLoaded", boot);
})();
</script>
</body>
</html>
